/**
 * Main Javascript methods.
 *
 * @author  Balcomsoft
 * @package Zero Gym
 * @version 1.0.0
 * @since   1.0.0
 */

/* Custom Script Index
-------------------
Init WOWjs
Overflow visible for sticy elements
Fixed Header
Scroll Disabler
Mega Menu Dropdown
Main Menu Dropdown
*/


(function ($) {
	// Define that this file uses modern javascript.
	"use strict";

	// When page is ready.
	$( document ).ready(
		function () {
			// 01. Overflow visible for sticky elements
			$( ".sticky" ).parents().css( "overflow", "visible" );


			let page_header = $( ".page-header" );

			// 02. Fixed Header
			if (page_header.hasClass( "make-fixed" )) {
				$( window ).scroll(
					function () {
						if ($( window ).scrollTop() > (($( ".show-fixed-header" ).length && $( ".show-fixed-header" ).offset().top + $( ".show-fixed-header" ).outerHeight()) || page_header.outerHeight())) {
							$( 'body' ).addClass( "fixed-menu" );
							$( '.page-header' ).addClass( "fixed-header" );
							$( ".page-main" ).css( "padding-top", $( ".page-header" ).outerHeight() )
						} else {
							$( 'body' ).removeClass( "fixed-menu" );
							$( '.page-header' ).removeClass( "fixed-header" );
							$( ".page-main" ).css( "padding-top", 0 )
						}
					}
				);
			}

			if (page_header.hasClass( "header-absolute" )) {
				page_header.attr( "absolute", true )
			}

			if ($( window ).width() < 991) {
				$( ".menu-item.menu-item-has-children > a" ).attr( 'href', "#" );
			}


			if (page_header.attr( "absolute" ) && (
				$( window ).width() > 991 && page_header.hasClass( "header-sticky-desktop" ) ||
				$( window ).width() > 768 && $( window ).width() < 991 && page_header.hasClass( "header-sticky-tablet" ) ||
				$( window ).width() < 768 && page_header.hasClass( "header-sticky-mobile" )
			)) {
				$( window ).scroll(
					function() {
						if ($( window ).scrollTop() >= 100) {
							page_header.removeClass( "header-absolute" );
						} else {
							page_header.addClass( "header-absolute" );
						}
					}
				);
			}

			let headerHeight = page_header.outerHeight();
			if (
				$( window ).width() > 991 && page_header.hasClass( "header-sticky-desktop" ) ||
				$( window ).width() > 768 && $( window ).width() < 991 && page_header.hasClass( "header-sticky-tablet" ) ||
				$( window ).width() < 768 && page_header.hasClass( "header-sticky-mobile" )
			) {
				if ( ! $( ".page-header" ).hasClass( "header-absolute" )) {
					$( ".page-wrapper" ).css( "padding-top", headerHeight + "px" );
				}
			}

			$( "[data-modal]" ).on(
				"click",
				function () {
					let id      = $( this ).attr( "data-modal" );
					let content = $( '[data-modal-content="' + id + '"]' );
					let overlay = $( '[data-modal-overlay="' + id + '"]' );
					if (content.length) {
						if (content.hasClass( "zrg-modal-active" )) {
							content.removeClass( "zrg-modal-active" );
							overlay.removeClass( "zrg-modal-overlay-active" );
							$( "body" ).removeClass( "disable-scroll" )
						} else {
							content.addClass( "zrg-modal-active" );
							overlay.addClass( "zrg-modal-overlay-active" );
							$( "body" ).addClass( "disable-scroll" )
						}
					}
				}
			);

			$( "[data-modal-overlay]" ).on(
				"click",
				function () {
					let content = $( '[data-modal-content="' + $( this ).attr( "data-modal-overlay" ) + '"]' );
					let overlay = $( '[data-modal-overlay="' + $( this ).attr( "data-modal-overlay" ) + '"]' );
					$( "body" ).removeClass( "disable-scroll" )
					content.removeClass( "zrg-modal-active" );
					overlay.removeClass( "zrg-modal-overlay-active" );
				}
			);

			// 03. Scroll Disabler
			function disableScroll(status) {
				if (status) {
					$( "body" ).addClass( "disable-scroll" );
				} else {
					$( "body" ).removeClass( "disable-scroll" );
				}
				$( window ).resize();
			}

			// Mobile Menu Open
			$( ".toggle-menu-open" ).on(
				"click",
				function () {
					$( ".header-menu" ).addClass( "menu-active" );
					disableScroll( true );
				}
			);
			// Mobile Menu Close
			$( ".toggle-menu-close" ).on(
				"click",
				function () {
					$( ".header-menu" ).removeClass( "menu-active" );
					disableScroll( false );
				}
			)

			// 10. Modal Switcher
			$( "[show-modal]" ).on(
				"click",
				function () {
					let elem = $( "[modal-id=" + $( this ).attr( "show-modal" ) + "]" );
					elem.addClass( "active" );
				}
			)
			$( "[hide-modal]" ).on(
				"click",
				function () {
					let elem = $( "[modal-id=" + $( this ).attr( "hide-modal" ) + "]" );
					elem.removeClass( "active" );
				}
			)
			$( document ).click(
				function (e) {
					let modal = $( ".modal" );
					if ( ! modal.is( e.target ) && modal.has( e.target ).length === 0) {
						if (e.target.closest( ".modal-wrapper" ) && e.target.closest( ".modal-wrapper" ).classList.length > 0) {
							e.target.closest( ".modal-wrapper" ).classList.remove( "active" )
						}
					}
				}
			);

			$( ".switch-view" ).on(
				"click",
				function (){
					let allList = $( this ).attr( "data-all-list" )
					let newItem = $( this ).attr( "data-new-item" )

					$( allList ).removeClass( "active" );
					$( newItem ).addClass( "active" );
				}
			);

			if ($( window ).width() <= 991) {
				$( ".header-menu .menu-item.menu-item-has-children .menu-link" ).on(
					"click",
					function (){
						$( this ).siblings( ".sub-menu" ).slideToggle();
					}
				);
			}

			// 11. Main Slider
			new Swiper(
				".zrg-slider",
				{
					draggable: true,
					grabCursor: true,
					autoHeight: true,
					// loop: true,
					// autoplay: {
					// delay: 2500,
					// disableOnInteraction: false,
					// pauseOnMouseEnter: true,
					// },
					pagination: {
						el: '.swiper-pagination',
						clickable: true,
						renderBullet: function (index, className) {
							return '<span class="' + className + '"></span>';
						},
					},
					keyboard: {
						enabled: true,
					},
				}
			);

			// 12. Video Player.
			$( ".video-play .video-play-btn" ).on(
				"click",
				function () {
					let id = $( this ).attr( "id" );
					if ($( this ).parent( ".video-play" ).hasClass( "playing" )) {
						$( this ).parent( ".video-play" ).removeClass( "playing" );
						$( "[data-video=" + id + "]" ).trigger( 'pause' );
					} else {
						$( this ).parent( ".video-play" ).addClass( "playing" );
						$( "[data-video=" + id + "]" ).trigger( 'play' );
					}
				}
			);

			$( '.reveal-real-player' ).on(
				'click',
				function (e) {
					e.preventDefault();
					$( this ).siblings( '.wp-video' ).unwrap( '.zrg-video-poster' );
					$( this ).siblings( 'iframe' ).unwrap( '.zrg-video-poster' );
					$( this ).siblings( '#zrg-vimeo-iframe-wrap' ).unwrap( '.zrg-video-poster' );
					$( this ).remove();
					$( this ).siblings( 'iframe' ).show();
					$( this ).siblings( '#zrg-vimeo-iframe-wrap' ).find( 'iframe' ).show();
				}
			);

			$( 'body' ).on(
				'hidden.bs.modal',
				function (e) {
					$( 'video' ).trigger( 'pause' );
					let iframes = $( e.target ).find( 'iframe' );
					iframes.each(
						function(index, iframe) {
							$( iframe ).attr( 'src', $( iframe ).attr( 'src' ) );
						}
					);
				}
			);

			$( document ).on(
				'click',
				'.zrg-play-button:not(.reveal-real-player)',
				function (e) {
					e.preventDefault();

					let video_id = $( this ).data( 'video' );

					if (typeof video_id === 'undefined' || video_id.length == 0) {
						return false;
					}

					let video_player_modal = bootstrap.Modal.getOrCreateInstance( document.getElementById( 'zerogym-video-modal' ) );

					// check old value.
					let current_id = $( '#zerogym-video-wrapper' ).data( 'current_video_id' );
					if (typeof current_id !== 'undefined' && current_id.length > 0 && current_id == video_id) {
						video_player_modal.show();
					} else {
						$( '#zerogym-video-wrapper' ).data( 'current_video_id', '' );
						$( '#zerogym-video-wrapper' ).html( '' );
						$.ajax(
							{
								url: zerogym_object.ajax_url,
								dataType: 'json',
								method: 'POST',
								data: {
									'video_id': video_id,
									'action': 'zrg_get_video_player_content',
									'security': zerogym_object.zrg_video_player,
								},
								complete: function (data) {
									var dt = data.responseJSON;
									if (typeof dt.html !== 'undefined') {
										$( '#zerogym-video-wrapper' ).data( 'current_video_id', dt.video_id );
										$( '#zerogym-video-wrapper' ).html( dt.html );
										// native HTML5 video
										if ($( '#zerogym-video-wrapper .zerogym-video-player .wp-video' ).length > 0) {
											$( '#zerogym-video-wrapper .zerogym-video-player .wp-video' ).css( 'width', '100%' );
										}
										video_player_modal.show();
									}
								}
							}
						);
					}
				}
			);

			$( '.toggler-arrow-wrap' ).on(
				'click touchend',
				function(e) {
					e.stopPropagation();
					e.preventDefault();
					let child_id = $( this ).data( 'child' );
					if (typeof child_id !== 'undefined') {
						let child_wrapper = $( '.zerogym-categories-widget .children.child-' + child_id );
						let clicked_arrow = $( '.toggler-arrow-wrap[data-child="' + child_id + '"] .toggler-arrow' );
						if (child_wrapper.is( ':visible' )) {
							child_wrapper.slideUp( 500 );
							clicked_arrow.css( 'transform', 'rotate(-45deg)' );
						} else {
							$( '.zerogym-categories-widget .children' ).slideUp( 500 );
							$( '.toggler-arrow-wrap .toggler-arrow' ).css( 'transform', 'rotate(-45deg)' );
							child_wrapper.slideDown( 500 );
							clicked_arrow.css( 'transform', 'rotate(45deg)' );
						}
					} else {
						let link = $( this ).closest( 'a' );
						if ( typeof link !== 'undefined' && link.length > 0) {
							let href = link.attr( "href" );
							if ( typeof href !== 'undefined' && href.length > 0) {
								location.href = href;
							}
						}
					}
				}
			);

			$( '.footer-subscription .mc4wp-form .mc4wp-form-fields input[type="submit"]' ).val( '>' );

			// load more pagination
			$( '.zrg-load-more' ).on(
				'click',
				function(){
					let loadMoreBtn = $( this );
					if (loadMoreBtn.hasClass( 'loading' )) {
						return false;
					}
					loadMoreBtn.addClass( 'loading' );

					let type    = loadMoreBtn.data( 'type' );
					let page    = loadMoreBtn.data( 'page' );
					let view    = loadMoreBtn.data( 'view' );
					let columns = loadMoreBtn.data( 'columns' );

					$.ajax(
						{
							url: zerogym_object.ajax_url,
							dataType: 'json',
							method: 'POST',
							data: {
								'type': type,
								'page': page,
								'view': view,
								'columns': columns,
								'action': 'zrg_general_load_more_paginator',
								'security': zerogym_object.zrg_load_more_paginator,
							},
							complete: function (data) {
								var dt = data.responseJSON;
								if (typeof dt.html !== 'undefined') {
									$( '.appendables-wrap' ).append( dt.html );
								}

								if (typeof dt.page !== 'undefined') {
									loadMoreBtn.data( 'page', dt.page ).attr( 'data-page', dt.page );

									if (typeof dt.max_pages !== 'undefined') {
										if (dt.page == dt.max_pages) {
											loadMoreBtn.remove();
										}
									}
								}

								loadMoreBtn.removeClass( 'loading' );
							}
						}
					);

				}
			);

			let progressBar = $( '.zrg-progress-wrapper' );
			$( progressBar ).each(
				function () {
					initProgress( $( this ) );
				}
			);

			function initProgress(item) {
				let progressFluid = item.find( '.progress-fluid' );
				let progressCount = "" + item.find( '.progress-count' ).text();
				if (progressCount.length > 1 && progressCount != 100) {
					let firstNumber  = progressCount[0];
					let secondNumber = progressCount[1];
					for (let i = 0; i < firstNumber; i++) {
						let progress = $( progressFluid[i] ).children();
						progress.css(
							{
								width: "100%"
							}
						)
					}
					$( progressFluid[firstNumber] ).children().css(
						{
							width: (secondNumber * 10) + '%'
						}
					)
				}
				if (progressCount.length === 1) {
					$( progressFluid[0] ).children().css(
						{
							width: (progressCount * 10) + '%'
						}
					)
				}
				if (+progressCount === 100) {
					$( progressFluid ).children().css(
						{
							width: '100%'
						}
					)
				}
			}
		}
	);

	$( window ).on(
		'load',
		function () {
			if ($( '.zerogym-video-player .wp-video' ).length > 0) {
				$( '.zerogym-video-player .wp-video' ).css( 'width', '100%' );
			}
		}
	);

})( window.jQuery );
